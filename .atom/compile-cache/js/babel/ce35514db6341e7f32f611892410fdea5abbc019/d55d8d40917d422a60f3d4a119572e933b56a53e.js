"use babel";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.activate = activate;
exports.deactivate = deactivate;
exports.handleURI = handleURI;
exports.deserialize = deserialize;
var path = null;
var PdfEditorView = null;
var querystring = null;

var config = {
  reverseSyncBehaviour: {
    type: "string",
    "enum": ['Disabled', 'Click', 'Double click'],
    'default': 'Click',
    title: "SyncTeX Reverse sync behaviour",
    description: "Specify the action on the PDF generated with the `--synctex=1` option that takes you to the source."
  },
  syncTeXPath: {
    type: "string",
    'default': "",
    title: "Path to synctex binary",
    description: "If not specified, look for `synctex` in `PATH`"
  },
  fitToWidthOnOpen: {
    type: "boolean",
    'default': false,
    title: "Fit to width on open",
    description: "When opening a document, fit it to the pane width"
  },
  paneToUseInSynctex: {
    type: "string",
    'enum': ['default', 'left', 'right', 'up', 'down'],
    'default': 'default',
    title: "Pane to use when opening new tex files",
    description: "When using reverse sync and a new tex source file has to be opened, use the provided pane to open the new file. 'default' will use the pane of the PDF viewer."
  },
  autoReloadOnUpdate: {
    type: "boolean",
    'default': true,
    title: "Auto reload on update",
    description: "Auto reload when the file is updated"
  },
  nightMode: {
    type: "boolean",
    "default": false,
    title: "Night Mode",
    description: "Inverts the colors of the pdf"
  }
};

exports.config = config;

function activate(state) {
  this.subscription = atom.workspace.addOpener(openUri);
  atom.packages.onDidActivateInitialPackages(createPdfStatusView);
}

function deactivate() {
  this.subscription.dispose();
}

function handleURI(parsedUri) {
  var query = Object.assign({}, parsedUri.query);

  if (parsedUri.hash) {
    // Allow query parameters to exist in hash to main compatability with Adobe
    // PDF style urls.
    if (parsedUri.hash.includes('=')) {
      if (querystring === null) {
        querystring = require('querystring');
      }

      Object.assign(query, querystring.parse(parsedUri.hash.substring(1)));
    } else {
      query.nameddest = parsedUri.hash.substring(1);
    }
  }

  var filePath = query.path || pathnameToFilePath(parsedUri.pathname);

  atom.workspace.open(filePath).then(function (view) {
    if (view) {
      if (query.source && query.line) {
        view.forwardSync(query.source, query.line);
      } else if (query.page) {
        view.scrollToPage(query.page);
      } else if (query.nameddest) {
        view.scrollToNamedDest(query.nameddest);
      }
    }
  });
}

function pathnameToFilePath(pathname) {
  var filePath = decodeURI(pathname || '');

  if (process.platform === 'win32') {
    filePath = filePath.replace(/\//g, '\\').replace(/^(.+)\|/, '$1:').replace(/\\([A-Z]:\\)/, '$1');
  } else if (!filePath.startsWith('/')) {
    filePath = "/" + filePath;
  }

  return filePath;
}

// Files with these extensions will be opened as PDFs
var pdfExtensions = new Set(['.pdf']);

function openUri(uriToOpen) {
  if (path === null) {
    path = require('path');
  }

  var uriExtension = path.extname(uriToOpen).toLowerCase();
  if (pdfExtensions.has(uriExtension)) {
    if (PdfEditorView === null) {
      PdfEditorView = require('./pdf-editor-view');
    }
    return new PdfEditorView(uriToOpen);
  }
}

function createPdfStatusView() {
  var PdfStatusBarView = require('./pdf-status-bar-view');
  new PdfStatusBarView();
  var PdfGoToPageView = require('./pdf-goto-page-view');
  new PdfGoToPageView();
}

function deserialize(_ref) {
  var filePath = _ref.filePath;
  var scale = _ref.scale;
  var scrollTop = _ref.scrollTop;
  var scrollLeft = _ref.scrollLeft;

  if (require('fs-plus').isFileSync(filePath)) {
    if (PdfEditorView === null) {
      PdfEditorView = require('./pdf-editor-view');
    }
    return new PdfEditorView(filePath, scale, scrollTop, scrollLeft);
  } else {
    console.warn("Could not deserialize PDF editor for path '#{filePath}' because that file no longer exists");
  }
}

if (parseFloat(atom.getVersion()) < 1.7) {
  atom.deserializers.add({
    "name": "PdfEditorDeserializer",
    "deserialize": deserialize
  });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9DcmlzRm9ybm8vZG90ZmlsZXMvLmF0b20vcGFja2FnZXMvcGRmLXZpZXcvbGliL3BkZi1lZGl0b3IuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsV0FBVyxDQUFDOzs7Ozs7Ozs7QUFFWixJQUFJLElBQUksR0FBRyxJQUFJLENBQUM7QUFDaEIsSUFBSSxhQUFhLEdBQUcsSUFBSSxDQUFDO0FBQ3pCLElBQUksV0FBVyxHQUFHLElBQUksQ0FBQzs7QUFFaEIsSUFBTSxNQUFNLEdBQUc7QUFDcEIsc0JBQW9CLEVBQUU7QUFDcEIsUUFBSSxFQUFFLFFBQVE7QUFDZCxZQUFNLENBQUMsVUFBVSxFQUFFLE9BQU8sRUFBRSxjQUFjLENBQUM7QUFDM0MsYUFBUyxFQUFFLE9BQU87QUFDbEIsU0FBSyxFQUFFLGdDQUFnQztBQUN2QyxlQUFXLEVBQUUscUdBQXFHO0dBQ25IO0FBQ0QsYUFBVyxFQUFFO0FBQ1gsUUFBSSxFQUFFLFFBQVE7QUFDZCxhQUFTLEVBQUUsRUFBRTtBQUNiLFNBQUssRUFBRSx3QkFBd0I7QUFDL0IsZUFBVyxFQUFFLGdEQUFnRDtHQUM5RDtBQUNELGtCQUFnQixFQUFFO0FBQ2hCLFFBQUksRUFBRSxTQUFTO0FBQ2YsYUFBUyxFQUFFLEtBQUs7QUFDaEIsU0FBSyxFQUFFLHNCQUFzQjtBQUM3QixlQUFXLEVBQUUsbURBQW1EO0dBQ2pFO0FBQ0Qsb0JBQWtCLEVBQUU7QUFDbEIsUUFBSSxFQUFFLFFBQVE7QUFDZCxVQUFNLEVBQUcsQ0FBQyxTQUFTLEVBQUUsTUFBTSxFQUFFLE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxDQUFDO0FBQ25ELGFBQVMsRUFBRSxTQUFTO0FBQ3BCLFNBQUssRUFBRSx3Q0FBd0M7QUFDL0MsZUFBVyxFQUFFLGdLQUFnSztHQUM5SztBQUNELG9CQUFrQixFQUFFO0FBQ2xCLFFBQUksRUFBRSxTQUFTO0FBQ2YsYUFBUyxFQUFFLElBQUk7QUFDZixTQUFLLEVBQUUsdUJBQXVCO0FBQzlCLGVBQVcs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QUM7R0FDbEUsTUFBTTtBQUNMLFdBQU8sQ0FBQyxJQUFJLENBQUMsNEZBQTRGLENBQUMsQ0FBQztHQUM1RztDQUNGOztBQUVELElBQUksVUFBVSxDQUFDLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQyxHQUFHLEdBQUcsRUFBRTtBQUN2QyxNQUFJLENBQUMsYUFBYSxDQUFDLEdBQUcsQ0FBQztBQUNyQixVQUFNLEVBQUUsdUJBQXVCO0FBQy9CLGlCQUFhLEVBQUUsV0FBVztHQUMzQixDQUFDLENBQUM7Q0FDSiIsImZpbGUiOiIvVXNlcnMvQ3Jpc0Zvcm5vL2RvdGZpbGVzLy5hdG9tL3BhY2thZ2VzL3BkZi12aWV3L2xpYi9wZGYtZWRpdG9yLmpzIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2UgYmFiZWxcIjtcblxudmFyIHBhdGggPSBudWxsO1xudmFyIFBkZkVkaXRvclZpZXcgPSBudWxsO1xudmFyIHF1ZXJ5c3RyaW5nID0gbnVsbDtcblxuZXhwb3J0IGNvbnN0IGNvbmZpZyA9IHtcbiAgcmV2ZXJzZVN5bmNCZWhhdmlvdXI6IHtcbiAgICB0eXBlOiBcInN0cmluZ1wiLFxuICAgIGVudW06IFsnRGlzYWJsZWQnLCAnQ2xpY2snLCAnRG91YmxlIGNsaWNrJ10sXG4gICAgJ2RlZmF1bHQnOiAnQ2xpY2snLFxuICAgIHRpdGxlOiBcIlN5bmNUZVggUmV2ZXJzZSBzeW5jIGJlaGF2aW91clwiLFxuICAgIGRlc2NyaXB0aW9uOiBcIlNwZWNpZnkgdGhlIGFjdGlvbiBvbiB0aGUgUERGIGdlbmVyYXRlZCB3aXRoIHRoZSBgLS1zeW5jdGV4PTFgIG9wdGlvbiB0aGF0IHRha2VzIHlvdSB0byB0aGUgc291cmNlLlwiXG4gIH0sXG4gIHN5bmNUZVhQYXRoOiB7XG4gICAgdHlwZTogXCJzdHJpbmdcIixcbiAgICAnZGVmYXVsdCc6IFwiXCIsXG4gICAgdGl0bGU6IFwiUGF0aCB0byBzeW5jdGV4IGJpbmFyeVwiLFxuICAgIGRlc2NyaXB0aW9uOiBcIklmIG5vdCBzcGVjaWZpZWQsIGxvb2sgZm9yIGBzeW5jdGV4YCBpbiBgUEFUSGBcIlxuICB9LFxuICBmaXRUb1dpZHRoT25PcGVuOiB7XG4gICAgdHlwZTogXCJib29sZWFuXCIsXG4gICAgJ2RlZmF1bHQnOiBmYWxzZSxcbiAgICB0aXRsZTogXCJGaXQgdG8gd2lkdGggb24gb3BlblwiLFxuICAgIGRlc2NyaXB0aW9uOiBcIldoZW4gb3BlbmluZyBhIGRvY3VtZW50LCBmaXQgaXQgdG8gdGhlIHBhbmUgd2lkdGhcIlxuICB9LFxuICBwYW5lVG9Vc2VJblN5bmN0ZXg6IHtcbiAgICB0eXBlOiBcInN0cmluZ1wiLFxuICAgICdlbnVtJyA6IFsnZGVmYXVsdCcsICdsZWZ0JywgJ3JpZ2h0JywgJ3VwJywgJ2Rvd24nXSxcbiAgICAnZGVmYXVsdCc6ICdkZWZhdWx0JyxcbiAgICB0aXRsZTogXCJQYW5lIHRvIHVzZSB3aGVuIG9wZW5pbmcgbmV3IHRleCBmaWxlc1wiLFxuICAgIGRlc2NyaXB0aW9uOiBcIldoZW4gdXNpbmcgcmV2ZXJzZSBzeW5jIGFuZCBhIG5ldyB0ZXggc291cmNlIGZpbGUgaGFzIHRvIGJlIG9wZW5lZCwgdXNlIHRoZSBwcm92aWRlZCBwYW5lIHRvIG9wZW4gdGhlIG5ldyBmaWxlLiAnZGVmYXVsdCcgd2lsbCB1c2UgdGhlIHBhbmUgb2YgdGhlIFBERiB2aWV3ZXIuXCJcbiAgfSxcbiAgYXV0b1JlbG9hZE9uVXBkYXRlOiB7XG4gICAgdHlwZTogXCJib29sZWFuXCIsXG4gICAgJ2RlZmF1bHQnOiB0cnVlLFxuICAgIHRpdGxlOiBcIkF1dG8gcmVsb2FkIG9uIHVwZGF0ZVwiLFxuICAgIGRlc2NyaXB0aW9uOiBcIkF1dG8gcmVsb2FkIHdoZW4gdGhlIGZpbGUgaXMgdXBkYXRlZFwiXG4gIH0sXG4gIG5pZ2h0TW9kZToge1xuICAgIHR5cGU6IFwiYm9vbGVhblwiLFxuICAgIGRlZmF1bHQ6IGZhbHNlLFxuICAgIHRpdGxlOiBcIk5pZ2h0IE1vZGVcIixcbiAgICBkZXNjcmlwdGlvbjogXCJJbnZlcnRzIHRoZSBjb2xvcnMgb2YgdGhlIHBkZlwiXG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGFjdGl2YXRlKHN0YXRlKSB7XG4gIHRoaXMuc3Vic2NyaXB0aW9uID0gYXRvbS53b3Jrc3BhY2UuYWRkT3BlbmVyKG9wZW5VcmkpO1xuICBhdG9tLnBhY2thZ2VzLm9uRGlkQWN0aXZhdGVJbml0aWFsUGFja2FnZXMoY3JlYXRlUGRmU3RhdHVzVmlldyk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBkZWFjdGl2YXRlKCkge1xuICB0aGlzLnN1YnNjcmlwdGlvbi5kaXNwb3NlKCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBoYW5kbGVVUkkocGFyc2VkVXJpKSB7XG4gIGNvbnN0IHF1ZXJ5ID0gT2JqZWN0LmFzc2lnbih7fSwgcGFyc2VkVXJpLnF1ZXJ5KVxuXG4gIGlmIChwYXJzZWRVcmkuaGFzaCkge1xuICAgIC8vIEFsbG93IHF1ZXJ5IHBhcmFtZXRlcnMgdG8gZXhpc3QgaW4gaGFzaCB0byBtYWluIGNvbXBhdGFiaWxpdHkgd2l0aCBBZG9iZVxuICAgIC8vIFBERiBzdHlsZSB1cmxzLlxuICAgIGlmIChwYXJzZWRVcmkuaGFzaC5pbmNsdWRlcygnPScpKSB7XG4gICAgICBpZiAocXVlcnlzdHJpbmcgPT09IG51bGwpIHtcbiAgICAgICAgcXVlcnlzdHJpbmcgPSByZXF1aXJlKCdxdWVyeXN0cmluZycpXG4gICAgICB9XG5cbiAgICAgIE9iamVjdC5hc3NpZ24ocXVlcnksIHF1ZXJ5c3RyaW5nLnBhcnNlKHBhcnNlZFVyaS5oYXNoLnN1YnN0cmluZygxKSkpXG4gICAgfSBlbHNlIHtcbiAgICAgIHF1ZXJ5Lm5hbWVkZGVzdCA9IHBhcnNlZFVyaS5oYXNoLnN1YnN0cmluZygxKVxuICAgIH1cbiAgfVxuXG4gIGNvbnN0IGZpbGVQYXRoID0gcXVlcnkucGF0aCB8fCBwYXRobmFtZVRvRmlsZVBhdGgocGFyc2VkVXJpLnBhdGhuYW1lKVxuXG4gIGF0b20ud29ya3NwYWNlLm9wZW4oZmlsZVBhdGgpLnRoZW4odmlldyA9PiB7XG4gICAgaWYgKHZpZXcpIHtcbiAgICAgIGlmIChxdWVyeS5zb3VyY2UgJiYgcXVlcnkubGluZSkge1xuICAgICAgICB2aWV3LmZvcndhcmRTeW5jKHF1ZXJ5LnNvdXJjZSwgcXVlcnkubGluZSlcbiAgICAgIH0gZWxzZSBpZiAocXVlcnkucGFnZSkge1xuICAgICAgICB2aWV3LnNjcm9sbFRvUGFnZShxdWVyeS5wYWdlKVxuICAgICAgfSBlbHNlIGlmIChxdWVyeS5uYW1lZGRlc3QpIHtcbiAgICAgICAgdmlldy5zY3JvbGxUb05hbWVkRGVzdChxdWVyeS5uYW1lZGRlc3QpXG4gICAgICB9XG4gICAgfVxuICB9KVxufVxuXG5mdW5jdGlvbiBwYXRobmFtZVRvRmlsZVBhdGgocGF0aG5hbWUpIHtcbiAgbGV0IGZpbGVQYXRoID0gZGVjb2RlVVJJKHBhdGhuYW1lIHx8ICcnKVxuXG4gIGlmIChwcm9jZXNzLnBsYXRmb3JtID09PSAnd2luMzInKSB7XG4gICAgZmlsZVBhdGggPSBmaWxlUGF0aC5yZXBsYWNlKC9cXC8vZywgJ1xcXFwnKS5yZXBsYWNlKC9eKC4rKVxcfC8sICckMTonKS5yZXBsYWNlKC9cXFxcKFtBLVpdOlxcXFwpLywgJyQxJylcbiAgfSBlbHNlIGlmICghZmlsZVBhdGguc3RhcnRzV2l0aCgnLycpKSB7XG4gICAgZmlsZVBhdGggPSBgLyR7ZmlsZVBhdGh9YFxuICB9XG5cbiAgcmV0dXJuIGZpbGVQYXRoXG59XG5cbi8vIEZpbGVzIHdpdGggdGhlc2UgZXh0ZW5zaW9ucyB3aWxsIGJlIG9wZW5lZCBhcyBQREZzXG5jb25zdCBwZGZFeHRlbnNpb25zID0gbmV3IFNldChbJy5wZGYnXSk7XG5cbmZ1bmN0aW9uIG9wZW5VcmkodXJpVG9PcGVuKSB7XG4gIGlmIChwYXRoID09PSBudWxsKSB7XG4gICAgcGF0aCA9IHJlcXVpcmUoJ3BhdGgnKTtcbiAgfVxuXG4gIGxldCB1cmlFeHRlbnNpb24gPSBwYXRoLmV4dG5hbWUodXJpVG9PcGVuKS50b0xvd2VyQ2FzZSgpXG4gIGlmIChwZGZFeHRlbnNpb25zLmhhcyh1cmlFeHRlbnNpb24pKSB7XG4gICAgaWYgKFBkZkVkaXRvclZpZXcgPT09IG51bGwpIHtcbiAgICAgIFBkZkVkaXRvclZpZXcgPSByZXF1aXJlKCcuL3BkZi1lZGl0b3ItdmlldycpO1xuICAgIH1cbiAgICByZXR1cm4gbmV3IFBkZkVkaXRvclZpZXcodXJpVG9PcGVuKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBjcmVhdGVQZGZTdGF0dXNWaWV3KCkge1xuICBsZXQgUGRmU3RhdHVzQmFyVmlldyA9IHJlcXVpcmUoJy4vcGRmLXN0YXR1cy1iYXItdmlldycpO1xuICBuZXcgUGRmU3RhdHVzQmFyVmlldygpO1xuICBsZXQgUGRmR29Ub1BhZ2VWaWV3ID0gcmVxdWlyZSgnLi9wZGYtZ290by1wYWdlLXZpZXcnKTtcbiAgbmV3IFBkZkdvVG9QYWdlVmlldygpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZGVzZXJpYWxpemUoe2ZpbGVQYXRoLCBzY2FsZSwgc2Nyb2xsVG9wLCBzY3JvbGxMZWZ0fSkge1xuICBpZiAocmVxdWlyZSgnZnMtcGx1cycpLmlzRmlsZVN5bmMoZmlsZVBhdGgpKSB7XG4gICAgaWYgKFBkZkVkaXRvclZpZXcgPT09IG51bGwpIHtcbiAgICAgIFBkZkVkaXRvclZpZXcgPSByZXF1aXJlKCcuL3BkZi1lZGl0b3ItdmlldycpO1xuICAgIH1cbiAgICByZXR1cm4gbmV3IFBkZkVkaXRvclZpZXcoZmlsZVBhdGgsIHNjYWxlLCBzY3JvbGxUb3AsIHNjcm9sbExlZnQpO1xuICB9IGVsc2Uge1xuICAgIGNvbnNvbGUud2FybihcIkNvdWxkIG5vdCBkZXNlcmlhbGl6ZSBQREYgZWRpdG9yIGZvciBwYXRoICcje2ZpbGVQYXRofScgYmVjYXVzZSB0aGF0IGZpbGUgbm8gbG9uZ2VyIGV4aXN0c1wiKTtcbiAgfVxufVxuXG5pZiAocGFyc2VGbG9hdChhdG9tLmdldFZlcnNpb24oKSkgPCAxLjcpIHtcbiAgYXRvbS5kZXNlcmlhbGl6ZXJzLmFkZCh7XG4gICAgXCJuYW1lXCI6IFwiUGRmRWRpdG9yRGVzZXJpYWxpemVyXCIsXG4gICAgXCJkZXNlcmlhbGl6ZVwiOiBkZXNlcmlhbGl6ZVxuICB9KTtcbn1cbiJdfQ==