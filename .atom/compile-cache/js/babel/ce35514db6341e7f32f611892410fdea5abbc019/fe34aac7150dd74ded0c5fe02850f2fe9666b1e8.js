function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

var _assert = require('assert');

var _assert2 = _interopRequireDefault(_assert);

var _libProvidersList = require('../lib/providers-list');

var _libProvidersList2 = _interopRequireDefault(_libProvidersList);

describe('ProvidersList', function () {
  var providersList = undefined;
  var editor = undefined;

  beforeEach(function () {
    if (providersList) {
      providersList.dispose();
    }
    providersList = new _libProvidersList2['default']();
    atom.workspace.destroyActivePane();
    waitsForPromise(function () {
      return atom.workspace.open(__filename).then(function () {
        editor = atom.workspace.getActiveTextEditor();
      });
    });
    atom.packages.activatePackage('language-javascript');
  });
  function addProvider(provider) {
    return providersList.addProvider(provider);
  }
  function deleteProvider(provider) {
    providersList.deleteProvider(provider);
  }

  describe('addProvider', function () {
    it('validates parameters properly', function () {
      expect(function () {
        addProvider();
      }).toThrow();
      expect(function () {
        addProvider(null);
      }).toThrow();
      expect(function () {
        addProvider(1);
      }).toThrow();
      expect(function () {
        addProvider(false);
      }).toThrow();
      expect(function () {
        addProvider(true);
      }).toThrow();

      expect(function () {
        addProvider({
          grammarScopes: false
        });
      }).toThrow();
      expect(function () {
        addProvider({
          grammarScopes: null
        });
      }).toThrow();
      expect(function () {
        addProvider({
          grammarScopes: true
        });
      }).toThrow();
      expect(function () {
        addProvider({
          grammarScopes: 5
        });
      }).toThrow();

      expect(function () {
        addProvider({
          grammarScopes: [],
          getIntentions: false
        });
      }).toThrow();
      expect(function () {
        addProvider({
          grammarScopes: [],
          getIntentions: null
        });
      }).toThrow();
      expect(function () {
        addProvider({
          grammarScopes: [],
          getIntentions: true
        });
      }).toThrow();
      expect(function () {
        addProvider({
          grammarScopes: [],
          getIntentions: 20
        });
      }).toThrow();
      addProvider({
        grammarScopes: [],
        getIntentions: function getIntentions() {}
      });
    });
  });
  describe('hasProvider', function () {
    it('works properly', function () {
      var provider = {
        grammarScopes: [],
        getIntentions: function getIntentions() {
          throw new Error();
        }
      };
      expect(providersList.hasProvider(provider)).toBe(false);
      addProvider(provider);
      expect(providersList.hasProvider(provider)).toBe(true);
    });
  });
  describe('deleteProvider', function () {
    it('works properly', function () {
      deleteProvider(true);
      deleteProvider(null);
      deleteProvider(false);
      deleteProvider(50);
      var provider = {
        grammarScopes: [],
        getIntentions: function getIntentions() {
          throw new Error();
        }
      };
      expect(providersList.hasProvider(provider)).toBe(false);
      addProvider(provider);
      expect(providersList.hasProvider(provider)).toBe(true);
      providersList.deleteProvider(provider);
      expect(providersList.hasProvider(provider)).toBe(false);
    });
  });
  describe('trigger', function () {
    it('works properly', function () {
      var intention = {
        priority: 100,
        icon: 'bucket',
        'class': 'custom-icon-class',
        title: 'Choose color from colorpicker',
        selected: function selected() {
          console.log('You clicked the color picker option');
        }
      };
      addProvider({
        grammarScopes: ['*'],
        getIntentions: function getIntentions() {
          return [intention];
        }
      });
      waitsForPromise(function () {
        return providersList.trigger(editor).then(function (results) {
          (0, _assert2['default'])(Array.isArray(results));
          expect(results[0]).toBe(intention);
        });
      });
    });
    it('ignores previous result from executed twice instantly', function () {
      var count = 0;
      var intentionFirst = {
        priority: 100,
        icon: 'bucket',
        'class': 'custom-icon-class',
        title: 'Choose color from colorpicker',
        selected: function selected() {
          console.log('You clicked the color picker option');
        }
      };
      var intentionSecond = {
        priority: 100,
        icon: 'bucket',
        'class': 'custom-icon-class',
        title: 'Choose color from colorpicker',
        selected: function selected() {
          console.log('You clicked the color picker option');
        }
      };
      addProvider({
        grammarScopes: ['*'],
        getIntentions: function getIntentions() {
          if (++count === 1) {
            return [intentionFirst];
          }
          return [intentionSecond];
        }
      });
      var promiseFirst = providersList.trigger(editor);
      var promiseSecond = providersList.trigger(editor);

      waitsForPromise(function () {
        return promiseFirst.then(function (results) {
          expect(results).toEqual([]);
        });
      });
      waitsForPromise(function () {
        return promiseSecond.then(function (results) {
          (0, _assert2['default'])(Array.isArray(results));
          expect(results[0]).toBe(intentionSecond);
        });
      });
    });
    it('does not enable it if providers return no results, including non-array ones', function () {
      addProvider({
        grammarScopes: ['*'],
        getIntentions: function getIntentions() {
          return [];
        }
      });
      addProvider({
        grammarScopes: ['*'],
        getIntentions: function getIntentions() {
          return null;
        }
      });
      addProvider({
        grammarScopes: ['*'],
        getIntentions: function getIntentions() {
          return false;
        }
      });
      addProvider({
        grammarScopes: ['*'],
        getIntentions: function getIntentions() {
          return 50;
        }
      });
      waitsForPromise(function () {
        return providersList.trigger(editor).then(function (results) {
          expect(results).toEqual([]);
        });
      });
    });
    it('emits an error if provider throws an error', function () {
      addProvider({
        grammarScopes: ['*'],
        getIntentions: function getIntentions() {
          throw new Error('test from provider');
        }
      });
      waitsForPromise(function () {
        return providersList.trigger(editor).then(function () {
          expect(false).toBe(true);
        }, function (e) {
          expect(e.message).toBe('test from provider');
        });
      });
    });
    it('validates suggestions properly', function () {
      addProvider({
        grammarScopes: ['*'],
        getIntentions: function getIntentions() {
          return [{}];
        }
      });
      waitsForPromise(function () {
        return providersList.trigger(editor).then(function () {
          expect(false).toBe(true);
        }, function (e) {
          expect(e instanceof Error).toBe(true);
        });
      });
    });
    it('triggers providers based on scope', function () {
      var coffeeCalled = false;
      var jsCalled = false;
      addProvider({
        grammarScopes: ['source.js'],
        getIntentions: function getIntentions() {
          jsCalled = true;
        }
      });
      addProvider({
        grammarScopes: ['source.coffee'],
        getIntentions: function getIntentions() {
          coffeeCalled = true;
        }
      });
      waitsForPromise(function () {
        return providersList.trigger(editor).then(function () {
          expect(jsCalled).toBe(true);
          expect(coffeeCalled).toBe(false);
        });
      });
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9DcmlzRm9ybm8vLmF0b20vcGFja2FnZXMvaW50ZW50aW9ucy9zcGVjL3Byb3ZpZGVycy1saXN0LXNwZWMuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7c0JBRXNCLFFBQVE7Ozs7Z0NBQ0osdUJBQXVCOzs7O0FBRWpELFFBQVEsQ0FBQyxlQUFlLEVBQUUsWUFBVztBQUNuQyxNQUFJLGFBQWEsWUFBQSxDQUFBO0FBQ2pCLE1BQUksTUFBTSxZQUFBLENBQUE7O0FBRVYsWUFBVSxDQUFDLFlBQVc7QUFDcEIsUUFBSSxhQUFhLEVBQUU7QUFDakIsbUJBQWEsQ0FBQyxPQUFPLEVBQUUsQ0FBQTtLQUN4QjtBQUNELGlCQUFhLEdBQUcsbUNBQW1CLENBQUE7QUFDbkMsUUFBSSxDQUFDLFNBQVMsQ0FBQyxpQkFBaUIsRUFBRSxDQUFBO0FBQ2xDLG1CQUFlLENBQUMsWUFBVztBQUN6QixhQUFPLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLElBQUksQ0FBQyxZQUFXO0FBQ3JELGNBQU0sR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLG1CQUFtQixFQUFFLENBQUE7T0FDOUMsQ0FBQyxDQUFBO0tBQ0gsQ0FBQyxDQUFBO0FBQ0YsUUFBSSxDQUFDLFFBQVEsQ0FBQyxlQUFlLENBQUMscUJBQXFCLENBQUMsQ0FBQTtHQUNyRCxDQUFDLENBQUE7QUFDRixXQUFTLFdBQVcsQ0FBQyxRQUFhLEVBQUU7QUFDbEMsV0FBTyxhQUFhLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQyxDQUFBO0dBQzNDO0FBQ0QsV0FBUyxjQUFjLENBQUMsUUFBYSxFQUFFO0FBQ3JDLGlCQUFhLENBQUMsY0FBYyxDQUFDLFFBQVEsQ0FBQyxDQUFBO0dBQ3ZDOztBQUVELFVBQVEsQ0FBQyxhQUFhLEVBQUUsWUFBVztBQUNqQyxNQUFFLENBQUMsK0JBQStCLEVBQUUsWUFBVztBQUM3QyxZQUFNLENBQUMsWUFBVztBQUNoQixtQkFBVyxFQUFFLENBQUE7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O09BQ0gsQ0FBQyxDQUFBO0tBQ0gsQ0FBQyxDQUFBO0dBQ0gsQ0FBQyxDQUFBO0NBQ0gsQ0FBQyxDQUFBIiwiZmlsZSI6Ii9Vc2Vycy9DcmlzRm9ybm8vLmF0b20vcGFja2FnZXMvaW50ZW50aW9ucy9zcGVjL3Byb3ZpZGVycy1saXN0LXNwZWMuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBAZmxvdyAqL1xuXG5pbXBvcnQgaW52YXJpYW50IGZyb20gJ2Fzc2VydCdcbmltcG9ydCBQcm92aWRlcnNMaXN0IGZyb20gJy4uL2xpYi9wcm92aWRlcnMtbGlzdCdcblxuZGVzY3JpYmUoJ1Byb3ZpZGVyc0xpc3QnLCBmdW5jdGlvbigpIHtcbiAgbGV0IHByb3ZpZGVyc0xpc3RcbiAgbGV0IGVkaXRvclxuXG4gIGJlZm9yZUVhY2goZnVuY3Rpb24oKSB7XG4gICAgaWYgKHByb3ZpZGVyc0xpc3QpIHtcbiAgICAgIHByb3ZpZGVyc0xpc3QuZGlzcG9zZSgpXG4gICAgfVxuICAgIHByb3ZpZGVyc0xpc3QgPSBuZXcgUHJvdmlkZXJzTGlzdCgpXG4gICAgYXRvbS53b3Jrc3BhY2UuZGVzdHJveUFjdGl2ZVBhbmUoKVxuICAgIHdhaXRzRm9yUHJvbWlzZShmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiBhdG9tLndvcmtzcGFjZS5vcGVuKF9fZmlsZW5hbWUpLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgIGVkaXRvciA9IGF0b20ud29ya3NwYWNlLmdldEFjdGl2ZVRleHRFZGl0b3IoKVxuICAgICAgfSlcbiAgICB9KVxuICAgIGF0b20ucGFja2FnZXMuYWN0aXZhdGVQYWNrYWdlKCdsYW5ndWFnZS1qYXZhc2NyaXB0JylcbiAgfSlcbiAgZnVuY3Rpb24gYWRkUHJvdmlkZXIocHJvdmlkZXI6IGFueSkge1xuICAgIHJldHVybiBwcm92aWRlcnNMaXN0LmFkZFByb3ZpZGVyKHByb3ZpZGVyKVxuICB9XG4gIGZ1bmN0aW9uIGRlbGV0ZVByb3ZpZGVyKHByb3ZpZGVyOiBhbnkpIHtcbiAgICBwcm92aWRlcnNMaXN0LmRlbGV0ZVByb3ZpZGVyKHByb3ZpZGVyKVxuICB9XG5cbiAgZGVzY3JpYmUoJ2FkZFByb3ZpZGVyJywgZnVuY3Rpb24oKSB7XG4gICAgaXQoJ3ZhbGlkYXRlcyBwYXJhbWV0ZXJzIHByb3Blcmx5JywgZnVuY3Rpb24oKSB7XG4gICAgICBleHBlY3QoZnVuY3Rpb24oKSB7XG4gICAgICAgIGFkZFByb3ZpZGVyKClcbiAgICAgIH0pLnRvVGhyb3coKVxuICAgICAgZXhwZWN0KGZ1bmN0aW9uKCkge1xuICAgICAgICBhZGRQcm92aWRlcihudWxsKVxuICAgICAgfSkudG9UaHJvdygpXG4gICAgICBleHBlY3QoZnVuY3Rpb24oKSB7XG4gICAgICAgIGFkZFByb3ZpZGVyKDEpXG4gICAgICB9KS50b1Rocm93KClcbiAgICAgIGV4cGVjdChmdW5jdGlvbigpIHtcbiAgICAgICAgYWRkUHJvdmlkZXIoZmFsc2UpXG4gICAgICB9KS50b1Rocm93KClcbiAgICAgIGV4cGVjdChmdW5jdGlvbigpIHtcbiAgICAgICAgYWRkUHJvdmlkZXIodHJ1ZSlcbiAgICAgIH0pLnRvVGhyb3coKVxuXG4gICAgICBleHBlY3QoZnVuY3Rpb24oKSB7XG4gICAgICAgIGFkZFByb3ZpZGVyKHtcbiAgICAgICAgICBncmFtbWFyU2NvcGVzOiBmYWxzZSxcbiAgICAgICAgfSlcbiAgICAgIH0pLnRvVGhyb3coKVxuICAgICAgZXhwZWN0KGZ1bmN0aW9uKCkge1xuICAgICAgICBhZGRQcm92aWRlcih7XG4gICAgICAgICAgZ3JhbW1hclNjb3BlczogbnVsbCxcbiAgICAgICAgfSlcbiAgICAgIH0pLnRvVGhyb3coKVxuICAgICAgZXhwZWN0KGZ1bmN0aW9uKCkge1xuICAgICAgICBhZGRQcm92aWRlcih7XG4gICAgICAgICAgZ3JhbW1hclNjb3BlczogdHJ1ZSxcbiAgICAgICAgfSlcbiAgICAgIH0pLnRvVGhyb3coKVxuICAgICAgZXhwZWN0KGZ1bmN0aW9uKCkge1xuICAgICAgICBhZGRQcm92aWRlcih7XG4gICAgICAgICAgZ3JhbW1hclNjb3BlczogNSxcbiAgICAgICAgfSlcbiAgICAgIH0pLnRvVGhyb3coKVxuXG4gICAgICBleHBlY3QoZnVuY3Rpb24oKSB7XG4gICAgICAgIGFkZFByb3ZpZGVyKHtcbiAgICAgICAgICBncmFtbWFyU2NvcGVzOiBbXSxcbiAgICAgICAgICBnZXRJbnRlbnRpb25zOiBmYWxzZSxcbiAgICAgICAgfSlcbiAgICAgIH0pLnRvVGhyb3coKVxuICAgICAgZXhwZWN0KGZ1bmN0aW9uKCkge1xuICAgICAgICBhZGRQcm92aWRlcih7XG4gICAgICAgICAgZ3JhbW1hclNjb3BlczogW10sXG4gICAgICAgICAgZ2V0SW50ZW50aW9uczogbnVsbCxcbiAgICAgICAgfSlcbiAgICAgIH0pLnRvVGhyb3coKVxuICAgICAgZXhwZWN0KGZ1bmN0aW9uKCkge1xuICAgICAgICBhZGRQcm92aWRlcih7XG4gICAgICAgICAgZ3JhbW1hclNjb3BlczogW10sXG4gICAgICAgICAgZ2V0SW50ZW50aW9uczogdHJ1ZSxcbiAgICAgICAgfSlcbiAgICAgIH0pLnRvVGhyb3coKVxuICAgICAgZXhwZWN0KGZ1bmN0aW9uKCkge1xuICAgICAgICBhZGRQcm92aWRlcih7XG4gICAgICAgICAgZ3JhbW1hclNjb3BlczogW10sXG4gICAgICAgICAgZ2V0SW50ZW50aW9uczogMjAsXG4gICAgICAgIH0pXG4gICAgICB9KS50b1Rocm93KClcbiAgICAgIGFkZFByb3ZpZGVyKHtcbiAgICAgICAgZ3JhbW1hclNjb3BlczogW10sXG4gICAgICAgIGdldEludGVudGlvbnMoKSB7fSxcbiAgICAgIH0pXG4gICAgfSlcbiAgfSlcbiAgZGVzY3JpYmUoJ2hhc1Byb3ZpZGVyJywgZnVuY3Rpb24oKSB7XG4gICAgaXQoJ3dvcmtzIHByb3Blcmx5JywgZnVuY3Rpb24oKSB7XG4gICAgICBjb25zdCBwcm92aWRlciA9IHtcbiAgICAgICAgZ3JhbW1hclNjb3BlczogW10sXG4gICAgICAgIGdldEludGVudGlvbnMoKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKClcbiAgICAgICAgfSxcbiAgICAgIH1cbiAgICAgIGV4cGVjdChwcm92aWRlcnNMaXN0Lmhhc1Byb3ZpZGVyKHByb3ZpZGVyKSkudG9CZShmYWxzZSlcbiAgICAgIGFkZFByb3ZpZGVyKHByb3ZpZGVyKVxuICAgICAgZXhwZWN0KHByb3ZpZGVyc0xpc3QuaGFzUHJvdmlkZXIocHJvdmlkZXIpKS50b0JlKHRydWUpXG4gICAgfSlcbiAgfSlcbiAgZGVzY3JpYmUoJ2RlbGV0ZVByb3ZpZGVyJywgZnVuY3Rpb24oKSB7XG4gICAgaXQoJ3dvcmtzIHByb3Blcmx5JywgZnVuY3Rpb24oKSB7XG4gICAgICBkZWxldGVQcm92aWRlcih0cnVlKVxuICAgICAgZGVsZXRlUHJvdmlkZXIobnVsbClcbiAgICAgIGRlbGV0ZVByb3ZpZGVyKGZhbHNlKVxuICAgICAgZGVsZXRlUHJvdmlkZXIoNTApXG4gICAgICBjb25zdCBwcm92aWRlciA9IHtcbiAgICAgICAgZ3JhbW1hclNjb3BlczogW10sXG4gICAgICAgIGdldEludGVudGlvbnMoKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKClcbiAgICAgICAgfSxcbiAgICAgIH1cbiAgICAgIGV4cGVjdChwcm92aWRlcnNMaXN0Lmhhc1Byb3ZpZGVyKHByb3ZpZGVyKSkudG9CZShmYWxzZSlcbiAgICAgIGFkZFByb3ZpZGVyKHByb3ZpZGVyKVxuICAgICAgZXhwZWN0KHByb3ZpZGVyc0xpc3QuaGFzUHJvdmlkZXIocHJvdmlkZXIpKS50b0JlKHRydWUpXG4gICAgICBwcm92aWRlcnNMaXN0LmRlbGV0ZVByb3ZpZGVyKHByb3ZpZGVyKVxuICAgICAgZXhwZWN0KHByb3ZpZGVyc0xpc3QuaGFzUHJvdmlkZXIocHJvdmlkZXIpKS50b0JlKGZhbHNlKVxuICAgIH0pXG4gIH0pXG4gIGRlc2NyaWJlKCd0cmlnZ2VyJywgZnVuY3Rpb24oKSB7XG4gICAgaXQoJ3dvcmtzIHByb3Blcmx5JywgZnVuY3Rpb24oKSB7XG4gICAgICBjb25zdCBpbnRlbnRpb24gPSB7XG4gICAgICAgIHByaW9yaXR5OiAxMDAsXG4gICAgICAgIGljb246ICdidWNrZXQnLFxuICAgICAgICBjbGFzczogJ2N1c3RvbS1pY29uLWNsYXNzJyxcbiAgICAgICAgdGl0bGU6ICdDaG9vc2UgY29sb3IgZnJvbSBjb2xvcnBpY2tlcicsXG4gICAgICAgIHNlbGVjdGVkKCkge1xuICAgICAgICAgIGNvbnNvbGUubG9nKCdZb3UgY2xpY2tlZCB0aGUgY29sb3IgcGlja2VyIG9wdGlvbicpXG4gICAgICAgIH0sXG4gICAgICB9XG4gICAgICBhZGRQcm92aWRlcih7XG4gICAgICAgIGdyYW1tYXJTY29wZXM6IFsnKiddLFxuICAgICAgICBnZXRJbnRlbnRpb25zKCkge1xuICAgICAgICAgIHJldHVybiBbaW50ZW50aW9uXVxuICAgICAgICB9LFxuICAgICAgfSlcbiAgICAgIHdhaXRzRm9yUHJvbWlzZShmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHByb3ZpZGVyc0xpc3QudHJpZ2dlcihlZGl0b3IpLnRoZW4oZnVuY3Rpb24ocmVzdWx0cykge1xuICAgICAgICAgIGludmFyaWFudChBcnJheS5pc0FycmF5KHJlc3VsdHMpKVxuICAgICAgICAgIGV4cGVjdChyZXN1bHRzWzBdKS50b0JlKGludGVudGlvbilcbiAgICAgICAgfSlcbiAgICAgIH0pXG4gICAgfSlcbiAgICBpdCgnaWdub3JlcyBwcmV2aW91cyByZXN1bHQgZnJvbSBleGVjdXRlZCB0d2ljZSBpbnN0YW50bHknLCBmdW5jdGlvbigpIHtcbiAgICAgIGxldCBjb3VudCA9IDBcbiAgICAgIGNvbnN0IGludGVudGlvbkZpcnN0ID0ge1xuICAgICAgICBwcmlvcml0eTogMTAwLFxuICAgICAgICBpY29uOiAnYnVja2V0JyxcbiAgICAgICAgY2xhc3M6ICdjdXN0b20taWNvbi1jbGFzcycsXG4gICAgICAgIHRpdGxlOiAnQ2hvb3NlIGNvbG9yIGZyb20gY29sb3JwaWNrZXInLFxuICAgICAgICBzZWxlY3RlZCgpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZygnWW91IGNsaWNrZWQgdGhlIGNvbG9yIHBpY2tlciBvcHRpb24nKVxuICAgICAgICB9LFxuICAgICAgfVxuICAgICAgY29uc3QgaW50ZW50aW9uU2Vjb25kID0ge1xuICAgICAgICBwcmlvcml0eTogMTAwLFxuICAgICAgICBpY29uOiAnYnVja2V0JyxcbiAgICAgICAgY2xhc3M6ICdjdXN0b20taWNvbi1jbGFzcycsXG4gICAgICAgIHRpdGxlOiAnQ2hvb3NlIGNvbG9yIGZyb20gY29sb3JwaWNrZXInLFxuICAgICAgICBzZWxlY3RlZCgpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZygnWW91IGNsaWNrZWQgdGhlIGNvbG9yIHBpY2tlciBvcHRpb24nKVxuICAgICAgICB9LFxuICAgICAgfVxuICAgICAgYWRkUHJvdmlkZXIoe1xuICAgICAgICBncmFtbWFyU2NvcGVzOiBbJyonXSxcbiAgICAgICAgZ2V0SW50ZW50aW9ucygpIHtcbiAgICAgICAgICBpZiAoKytjb3VudCA9PT0gMSkge1xuICAgICAgICAgICAgcmV0dXJuIFtpbnRlbnRpb25GaXJzdF1cbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIFtpbnRlbnRpb25TZWNvbmRdXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgY29uc3QgcHJvbWlzZUZpcnN0ID0gcHJvdmlkZXJzTGlzdC50cmlnZ2VyKGVkaXRvcilcbiAgICAgIGNvbnN0IHByb21pc2VTZWNvbmQgPSBwcm92aWRlcnNMaXN0LnRyaWdnZXIoZWRpdG9yKVxuXG4gICAgICB3YWl0c0ZvclByb21pc2UoZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiBwcm9taXNlRmlyc3QudGhlbihmdW5jdGlvbihyZXN1bHRzKSB7XG4gICAgICAgICAgZXhwZWN0KHJlc3VsdHMpLnRvRXF1YWwoW10pXG4gICAgICAgIH0pXG4gICAgICB9KVxuICAgICAgd2FpdHNGb3JQcm9taXNlKGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gcHJvbWlzZVNlY29uZC50aGVuKGZ1bmN0aW9uKHJlc3VsdHMpIHtcbiAgICAgICAgICBpbnZhcmlhbnQoQXJyYXkuaXNBcnJheShyZXN1bHRzKSlcbiAgICAgICAgICBleHBlY3QocmVzdWx0c1swXSkudG9CZShpbnRlbnRpb25TZWNvbmQpXG4gICAgICAgIH0pXG4gICAgICB9KVxuICAgIH0pXG4gICAgaXQoJ2RvZXMgbm90IGVuYWJsZSBpdCBpZiBwcm92aWRlcnMgcmV0dXJuIG5vIHJlc3VsdHMsIGluY2x1ZGluZyBub24tYXJyYXkgb25lcycsIGZ1bmN0aW9uKCkge1xuICAgICAgYWRkUHJvdmlkZXIoe1xuICAgICAgICBncmFtbWFyU2NvcGVzOiBbJyonXSxcbiAgICAgICAgZ2V0SW50ZW50aW9ucygpIHtcbiAgICAgICAgICByZXR1cm4gW11cbiAgICAgICAgfSxcbiAgICAgIH0pXG4gICAgICBhZGRQcm92aWRlcih7XG4gICAgICAgIGdyYW1tYXJTY29wZXM6IFsnKiddLFxuICAgICAgICBnZXRJbnRlbnRpb25zKCkge1xuICAgICAgICAgIHJldHVybiBudWxsXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgYWRkUHJvdmlkZXIoe1xuICAgICAgICBncmFtbWFyU2NvcGVzOiBbJyonXSxcbiAgICAgICAgZ2V0SW50ZW50aW9ucygpIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgICAgfSxcbiAgICAgIH0pXG4gICAgICBhZGRQcm92aWRlcih7XG4gICAgICAgIGdyYW1tYXJTY29wZXM6IFsnKiddLFxuICAgICAgICBnZXRJbnRlbnRpb25zKCkge1xuICAgICAgICAgIHJldHVybiA1MFxuICAgICAgICB9LFxuICAgICAgfSlcbiAgICAgIHdhaXRzRm9yUHJvbWlzZShmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHByb3ZpZGVyc0xpc3QudHJpZ2dlcihlZGl0b3IpLnRoZW4oZnVuY3Rpb24ocmVzdWx0cykge1xuICAgICAgICAgIGV4cGVjdChyZXN1bHRzKS50b0VxdWFsKFtdKVxuICAgICAgICB9KVxuICAgICAgfSlcbiAgICB9KVxuICAgIGl0KCdlbWl0cyBhbiBlcnJvciBpZiBwcm92aWRlciB0aHJvd3MgYW4gZXJyb3InLCBmdW5jdGlvbigpIHtcbiAgICAgIGFkZFByb3ZpZGVyKHtcbiAgICAgICAgZ3JhbW1hclNjb3BlczogWycqJ10sXG4gICAgICAgIGdldEludGVudGlvbnMoKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCd0ZXN0IGZyb20gcHJvdmlkZXInKVxuICAgICAgICB9LFxuICAgICAgfSlcbiAgICAgIHdhaXRzRm9yUHJvbWlzZShmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHByb3ZpZGVyc0xpc3QudHJpZ2dlcihlZGl0b3IpLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgZXhwZWN0KGZhbHNlKS50b0JlKHRydWUpXG4gICAgICAgIH0sIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICBleHBlY3QoZS5tZXNzYWdlKS50b0JlKCd0ZXN0IGZyb20gcHJvdmlkZXInKVxuICAgICAgICB9KVxuICAgICAgfSlcbiAgICB9KVxuICAgIGl0KCd2YWxpZGF0ZXMgc3VnZ2VzdGlvbnMgcHJvcGVybHknLCBmdW5jdGlvbigpIHtcbiAgICAgIGFkZFByb3ZpZGVyKHtcbiAgICAgICAgZ3JhbW1hclNjb3BlczogWycqJ10sXG4gICAgICAgIGdldEludGVudGlvbnMoKSB7XG4gICAgICAgICAgcmV0dXJuIFt7fV1cbiAgICAgICAgfSxcbiAgICAgIH0pXG4gICAgICB3YWl0c0ZvclByb21pc2UoZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiBwcm92aWRlcnNMaXN0LnRyaWdnZXIoZWRpdG9yKS50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGV4cGVjdChmYWxzZSkudG9CZSh0cnVlKVxuICAgICAgICB9LCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgZXhwZWN0KGUgaW5zdGFuY2VvZiBFcnJvcikudG9CZSh0cnVlKVxuICAgICAgICB9KVxuICAgICAgfSlcbiAgICB9KVxuICAgIGl0KCd0cmlnZ2VycyBwcm92aWRlcnMgYmFzZWQgb24gc2NvcGUnLCBmdW5jdGlvbigpIHtcbiAgICAgIGxldCBjb2ZmZWVDYWxsZWQgPSBmYWxzZVxuICAgICAgbGV0IGpzQ2FsbGVkID0gZmFsc2VcbiAgICAgIGFkZFByb3ZpZGVyKHtcbiAgICAgICAgZ3JhbW1hclNjb3BlczogWydzb3VyY2UuanMnXSxcbiAgICAgICAgZ2V0SW50ZW50aW9ucygpIHtcbiAgICAgICAgICBqc0NhbGxlZCA9IHRydWVcbiAgICAgICAgfSxcbiAgICAgIH0pXG4gICAgICBhZGRQcm92aWRlcih7XG4gICAgICAgIGdyYW1tYXJTY29wZXM6IFsnc291cmNlLmNvZmZlZSddLFxuICAgICAgICBnZXRJbnRlbnRpb25zKCkge1xuICAgICAgICAgIGNvZmZlZUNhbGxlZCA9IHRydWVcbiAgICAgICAgfSxcbiAgICAgIH0pXG4gICAgICB3YWl0c0ZvclByb21pc2UoZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiBwcm92aWRlcnNMaXN0LnRyaWdnZXIoZWRpdG9yKS50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGV4cGVjdChqc0NhbGxlZCkudG9CZSh0cnVlKVxuICAgICAgICAgIGV4cGVjdChjb2ZmZWVDYWxsZWQpLnRvQmUoZmFsc2UpXG4gICAgICAgIH0pXG4gICAgICB9KVxuICAgIH0pXG4gIH0pXG59KVxuIl19